<!DOCTYPE html>
<html>
  <head>
    <title>Engagement Photo Booth</title>
    <style>
      body {
        font-family: sans-serif;
        text-align: center;
        margin: 20px;
      }
      video,
      canvas {
        border: 2px solid #ccc;
        border-radius: 10px;
      }
      button {
        padding: 10px 20px;
        font-size: 18px;
        margin-top: 15px;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  </head>
  <body>
    <h2>ðŸ“¸ Snap a Photo for the Couple!</h2>
    <video id="video" width="300" autoplay playsinline></video>
    <br />
    <button id="snapBtn">ðŸ“· Take Photo</button>

    <canvas id="canvas" width="300" height="200" style="display: none"></canvas>

    <script>
      // Supabase config - replace these with your actual project values
      const supabase = supabase.createClient(
        "https://idhpscdhasbnpxnjqvuj.supabase.co",
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlkaHBzY2RoYXNibnB4bmpxdnVqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5MDc3MzIsImV4cCI6MjA2OTQ4MzczMn0.OUfqirT2FpGroHKf35tjvsH6K06ddNIvTCE_7TYR29Y"
      );

      const video = document.getElementById("video");
      const canvas = document.getElementById("canvas");
      const snapBtn = document.getElementById("snapBtn");
      const context = canvas.getContext("2d");

      // Ask for camera access when the page loads
      navigator.mediaDevices
        .getUserMedia({ video: true })
        .then((stream) => {
          video.srcObject = stream;
        })
        .catch((err) => {
          alert("Camera access is required to take a photo.");
          console.error(err);
        });

      snapBtn.addEventListener("click", async () => {
        // Capture photo
        context.drawImage(video, 0, 0, canvas.width, canvas.height);
        canvas.toBlob(async (blob) => {
          const fileName = `photo-${Date.now()}.png`;

          // Upload to Supabase
          const { data, error } = await supabase.storage
            .from("engagement-photos") // your bucket name
            .upload(fileName, blob, {
              contentType: "image/png",
            });

          if (error) {
            alert("Upload failed. Please try again.");
            console.error(error);
          } else {
            alert("Photo uploaded successfully. Thank you!");
          }
        }, "image/png");
      });
    </script>
  </body>
</html>
